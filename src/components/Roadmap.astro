---
import type { Locale } from '~/types';
import { getLocalizedText, getLocaleFromUrl } from '~/utils/i18n';

interface Props {
  locale?: Locale;
}

const currentLocale = Astro.props.locale || getLocaleFromUrl(Astro.url);

const roadmapContent = {
  title: {
    ja: 'SuperSheet ロードマップ',
    en: 'SuperSheet Roadmap',
    zh: 'SuperSheet 路线图',
    ko: 'SuperSheet 로드맵'
  },
  subtitle: {
    ja: 'ハイブリッド表計算の革命は、もう始まっています。',
    en: 'The hybrid spreadsheet revolution has already begun.',
    zh: '混合电子表格革命已经开始。',
    ko: '하이브리드 스프레드시트 혁명이 이미 시작되었습니다.'
  },
  currentPhase: {
    ja: '私たちは今、最終調整のフェーズにいます。',
    en: 'We are currently in the final refinement phase.',
    zh: '我们目前正处于最终完善阶段。',
    ko: '우리는 현재 최종 개선 단계에 있습니다.'
  },
  milestones: [
    {
      id: 'q1-2026',
      period: {
        ja: 'Q1 2026 (1-2月)',
        en: 'Q1 2026 (Jan - Feb)',
        zh: '2026年第一季度 (1-2月)',
        ko: '2026년 1분기 (1-2월)'
      },
      title: {
        ja: 'エンジンの極限化',
        en: 'Engine Refinement',
        zh: '引擎优化',
        ko: '엔진 최적화'
      },
      status: 'in-progress',
      description: {
        ja: '現在、私たちが注力しているのは「手触り」です。',
        en: 'We are currently focusing on the "feel" of the experience.',
        zh: '我们目前专注于"手感"体验。',
        ko: '현재 우리는 "사용감"에 집중하고 있습니다.'
      },
      features: [
        {
          title: {
            ja: 'Zero Latency',
            en: 'Zero Latency',
            zh: '零延迟',
            ko: '제로 레이턴시'
          },
          description: {
            ja: 'ローカル操作の応答速度を極限までチューニング',
            en: 'Tuning local operation response speed to the extreme',
            zh: '将本地操作响应速度调整到极致',
            ko: '로컬 작업 응답 속도를 극한까지 튜닝'
          }
        },
        {
          title: {
            ja: 'Stress Test',
            en: 'Stress Test',
            zh: '压力测试',
            ko: '스트레스 테스트'
          },
          description: {
            ja: '100万行データのスクロール・編集負荷テスト',
            en: 'Scroll and edit load testing with 1 million rows of data',
            zh: '100万行数据的滚动和编辑负载测试',
            ko: '100만 행 데이터의 스크롤 및 편집 부하 테스트'
          }
        },
        {
          title: {
            ja: 'Core Stability',
            en: 'Core Stability',
            zh: '核心稳定性',
            ko: '코어 안정성'
          },
          description: {
            ja: 'SQLite基盤の堅牢性検証完了',
            en: 'SQLite foundation robustness verification completed',
            zh: '完成SQLite基础的稳健性验证',
            ko: 'SQLite 기반의 견고성 검증 완료'
          }
        }
      ]
    },
    {
      id: 'march-2026',
      period: {
        ja: '2026年3月',
        en: 'March 2026',
        zh: '2026年3月',
        ko: '2026년 3월'
      },
      title: {
        ja: '選ばれし者のための先行アクセス',
        en: 'Closed Beta Access',
        zh: '封闭测试版访问',
        ko: '비공개 베타 액세스'
      },
      status: 'upcoming',
      description: {
        ja: '4月の一般公開を前に、ウェイティングリスト登録者の中から限定数名を招待します。',
        en: 'Before the April public release, we will invite a limited number of waitlist registrants.',
        zh: '在4月公开发布之前，我们将从候补名单注册者中邀请有限数量的用户。',
        ko: '4월 공개 출시 전에 대기자 명단 등록자 중 제한된 수를 초대합니다.'
      },
      features: [
        {
          title: {
            ja: 'Exclusive Invite',
            en: 'Exclusive Invite',
            zh: '独家邀请',
            ko: '독점 초대'
          },
          description: {
            ja: '登録者限定の招待状送付',
            en: 'Invitation-only access for registered users',
            zh: '仅向注册用户发送邀请',
            ko: '등록자 한정 초대장 발송'
          }
        },
        {
          title: {
            ja: 'Sync Engine Unlocked',
            en: 'Sync Engine Unlocked',
            zh: '同步引擎解锁',
            ko: '동기화 엔진 언락'
          },
          description: {
            ja: 'デバイス間同期機能の解禁',
            en: 'Cross-device synchronization features unlocked',
            zh: '跨设备同步功能解锁',
            ko: '기기 간 동기화 기능 해금'
          }
        },
        {
          title: {
            ja: 'Feedback Loop',
            en: 'Feedback Loop',
            zh: '反馈循环',
            ko: '피드백 루프'
          },
          description: {
            ja: '開発チームとの直接的な対話チャンネル',
            en: 'Direct communication channel with the development team',
            zh: '与开发团队的直接对话渠道',
            ko: '개발팀과의 직접적인 대화 채널'
          }
        }
      ]
    },
    {
      id: 'april-2026',
      period: {
        ja: '2026年4月',
        en: 'April 2026',
        zh: '2026年4月',
        ko: '2026년 4월'
      },
      title: {
        ja: 'ハイブリッド革命の始まり',
        en: 'Public Beta Launch',
        zh: '混合革命的开始',
        ko: '하이브리드 혁명의 시작'
      },
      status: 'future',
      highlight: true,
      description: {
        ja: '待望のリリース。SuperSheetが、あなたの生産性を再定義します。',
        en: 'The long-awaited release. SuperSheet will redefine your productivity.',
        zh: '期待已久的发布。SuperSheet将重新定义您的生产力。',
        ko: '대망의 릴리스. SuperSheet가 여러분의 생산성을 재정의합니다.'
      },
      features: [
        {
          title: {
            ja: 'Grand Opening',
            en: 'Grand Opening',
            zh: '盛大开放',
            ko: '그랜드 오프닝'
          },
          description: {
            ja: '全てのユーザーへのアクセス開放',
            en: 'Access opened to all users',
            zh: '向所有用户开放访问',
            ko: '모든 사용자에게 액세스 개방'
          }
        },
        {
          title: {
            ja: 'Magic Import',
            en: 'Magic Import',
            zh: '魔法导入',
            ko: '매직 임포트'
          },
          description: {
            ja: 'AIによる「画像からのデータ構造化」機能搭載',
            en: 'AI-powered "data structuring from images" feature',
            zh: 'AI驱动的"从图像进行数据结构化"功能',
            ko: 'AI 기반 "이미지에서 데이터 구조화" 기능 탑재'
          }
        },
        {
          title: {
            ja: 'Cloud Connect',
            en: 'Cloud Connect',
            zh: '云连接',
            ko: '클라우드 커넥트'
          },
          description: {
            ja: '外部API連携機能のベータ提供開始',
            en: 'Beta release of external API integration features',
            zh: '开始提供外部API集成功能的测试版',
            ko: '외부 API 연동 기능의 베타 제공 시작'
          }
        }
      ]
    },
    {
      id: 'late-2026',
      period: {
        ja: '2026年後半',
        en: 'Late 2026',
        zh: '2026年下半年',
        ko: '2026년 하반기'
      },
      title: {
        ja: '組織のOSへ',
        en: 'Ecosystem Expansion',
        zh: '生态系统扩展',
        ko: '생태계 확장'
      },
      status: 'future',
      description: {
        ja: '個人ツールから、チームのコラボレーション基盤へ進化します。',
        en: 'Evolving from individual tools to team collaboration platforms.',
        zh: '从个人工具发展为团队协作基础。',
        ko: '개인 도구에서 팀 협업 기반으로 발전합니다.'
      },
      features: [
        {
          title: {
            ja: 'Team Workspace',
            en: 'Team Workspace',
            zh: '团队工作区',
            ko: '팀 워크스페이스'
          },
          description: {
            ja: 'リアルタイム共同編集',
            en: 'Real-time collaborative editing',
            zh: '实时协作编辑',
            ko: '실시간 공동 편집'
          }
        },
        {
          title: {
            ja: 'Enterprise Security',
            en: 'Enterprise Security',
            zh: '企业安全',
            ko: '엔터프라이즈 보안'
          },
          description: {
            ja: 'RLS（行レベルセキュリティ）と監査ログ',
            en: 'RLS (Row Level Security) and audit logs',
            zh: 'RLS（行级安全）和审计日志',
            ko: 'RLS(행 수준 보안) 및 감사 로그'
          }
        },
        {
          title: {
            ja: 'Plugin Marketplace',
            en: 'Plugin Marketplace',
            zh: '插件市场',
            ko: '플러그인 마켓플레이스'
          },
          description: {
            ja: '拡張機能による無限の可能性',
            en: 'Infinite possibilities through extensions',
            zh: '通过扩展功能提供无限可能',
            ko: '확장 기능으로 무한한 가능성'
          }
        }
      ]
    }
  ]
};
---

<div class="py-16 bg-gradient-to-br from-neutral-50 via-white to-accent-50 relative overflow-hidden">
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-5">
    <svg class="w-full h-full" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="roadmap-grid" width="10" height="10" patternUnits="userSpaceOnUse">
          <circle cx="5" cy="5" r="0.5" fill="currentColor"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#roadmap-grid)"/>
    </svg>
  </div>

  <div class="container-custom relative">
    <!-- Header -->
    <div class="text-center mb-16 animate-on-scroll">
      <div class="inline-flex items-center justify-center space-x-2 mb-6">
        <div class="w-2 h-2 bg-accent-500 rounded-full animate-pulse"></div>
        <div class="w-2 h-2 bg-accent-400 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
        <div class="w-2 h-2 bg-accent-300 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
      </div>
      
      <h1 class="heading-xl mb-6 bg-gradient-to-r from-primary-900 via-primary-600 to-accent-600 bg-clip-text text-transparent">
        {getLocalizedText(roadmapContent.title, currentLocale)}
      </h1>
      
      <p class="text-lead text-neutral-600 mb-4 max-w-3xl mx-auto">
        {getLocalizedText(roadmapContent.subtitle, currentLocale)}
      </p>
      
      <p class="text-body text-neutral-500 max-w-2xl mx-auto">
        {getLocalizedText(roadmapContent.currentPhase, currentLocale)}
      </p>
    </div>

    <!-- Timeline -->
    <div class="relative">
      <!-- Vertical Timeline Line -->
      <div class="absolute left-1/2 transform -translate-x-px top-0 bottom-0 w-0.5 bg-gradient-to-b from-accent-200 via-accent-400 to-accent-200 hidden lg:block"></div>

      <div class="space-y-20">
        {roadmapContent.milestones.map((milestone, index) => (
          <div 
            class={`roadmap-milestone animate-on-scroll ${
              index % 2 === 0 ? 'lg:flex-row' : 'lg:flex-row-reverse'
            }`}
            data-milestone-id={milestone.id}
            style={`animation-delay: ${index * 0.2}s`}
          >
            <div class="flex flex-col lg:flex-row items-center lg:space-x-0 space-y-8 lg:space-y-0">
              
              <!-- Content Card -->
              <div class={`flex-1 ${index % 2 === 0 ? 'lg:pr-16' : 'lg:pl-16'} relative`}>
                <div class={`milestone-card bg-white rounded-2xl p-8 shadow-lg border border-neutral-200 hover:shadow-xl transition-all duration-500 hover:-translate-y-2 ${
                  milestone.highlight ? 'ring-2 ring-accent-400/20 bg-gradient-to-br from-white to-accent-50' : ''
                }`}>
                  
                  <!-- Status Badge -->
                  <div class="flex items-center space-x-3 mb-6">
                    <div class={`status-indicator w-3 h-3 rounded-full ${
                      milestone.status === 'in-progress' ? 'bg-yellow-400 animate-pulse' :
                      milestone.status === 'upcoming' ? 'bg-blue-400 animate-pulse' :
                      milestone.status === 'future' ? 'bg-neutral-300' : 'bg-green-400'
                    }`}></div>
                    <span class={`text-sm font-medium px-3 py-1 rounded-full ${
                      milestone.status === 'in-progress' ? 'bg-yellow-100 text-yellow-800' :
                      milestone.status === 'upcoming' ? 'bg-blue-100 text-blue-800' :
                      milestone.status === 'future' ? 'bg-neutral-100 text-neutral-600' : 'bg-green-100 text-green-800'
                    }`}>
                      {getLocalizedText(milestone.period, currentLocale)}
                    </span>
                  </div>

                  <!-- Title and Description -->
                  <h3 class={`text-2xl font-bold mb-4 ${
                    milestone.highlight ? 'text-transparent bg-gradient-to-r from-accent-600 to-primary-600 bg-clip-text' : 'text-neutral-900'
                  }`}>
                    {getLocalizedText(milestone.title, currentLocale)}
                  </h3>
                  
                  <p class="text-neutral-600 mb-6 leading-relaxed">
                    {getLocalizedText(milestone.description, currentLocale)}
                  </p>

                  <!-- Features List -->
                  <div class="space-y-4">
                    {milestone.features.map((feature) => (
                      <div class="feature-item flex items-start space-x-3 p-3 rounded-lg hover:bg-neutral-50 transition-colors duration-200">
                        <div class="feature-icon w-2 h-2 rounded-full bg-accent-400 mt-2 flex-shrink-0"></div>
                        <div class="flex-1">
                          <h4 class="font-semibold text-neutral-900 mb-1">
                            {getLocalizedText(feature.title, currentLocale)}
                          </h4>
                          <p class="text-sm text-neutral-600 leading-relaxed">
                            {getLocalizedText(feature.description, currentLocale)}
                          </p>
                        </div>
                      </div>
                    ))}
                  </div>

                  {milestone.highlight && (
                    <div class="mt-6 p-4 bg-gradient-to-r from-accent-500/10 to-primary-500/10 rounded-lg border border-accent-200/50">
                      <div class="flex items-center space-x-2 text-accent-700">
                        <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                        <span class="font-medium">
                          {currentLocale === 'ja' ? '最も注目のリリース！' 
                            : currentLocale === 'zh' ? '最受关注的发布！'
                            : currentLocale === 'ko' ? '가장 주목받는 릴리스!'
                            : 'Most Anticipated Release!'}
                        </span>
                      </div>
                    </div>
                  )}
                </div>
              </div>

              <!-- Timeline Node -->
              <div class="hidden lg:block relative z-10">
                <div class={`timeline-node w-6 h-6 rounded-full border-4 border-white shadow-lg ${
                  milestone.status === 'in-progress' ? 'bg-yellow-400 animate-pulse' :
                  milestone.status === 'upcoming' ? 'bg-blue-400 animate-pulse' :
                  milestone.status === 'future' ? 'bg-neutral-300' : 'bg-green-400'
                }`}></div>
                
                {milestone.highlight && (
                  <div class="absolute -inset-2 bg-accent-400/20 rounded-full animate-ping"></div>
                )}
              </div>

              <!-- Empty space for alignment -->
              <div class="flex-1 hidden lg:block"></div>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Call to Action -->
    <div class="text-center mt-20 animate-on-scroll">
      <div class="bg-gradient-to-r from-primary-600 to-accent-600 rounded-2xl p-8 text-white shadow-xl">
        <h3 class="text-2xl font-bold mb-4">
          {currentLocale === 'ja' ? '革命に参加しませんか？' 
            : currentLocale === 'zh' ? '加入革命吧！'
            : currentLocale === 'ko' ? '혁명에 참여하세요!'
            : 'Join the Revolution!'}
        </h3>
        <p class="text-primary-100 mb-6 max-w-2xl mx-auto">
          {currentLocale === 'ja' ? 'ウェイティングリストに登録して、SuperSheetの未来を一緒に作りましょう。' 
            : currentLocale === 'zh' ? '注册候补名单，与我们一起创造SuperSheet的未来。'
            : currentLocale === 'ko' ? '대기자 명단에 등록하여 SuperSheet의 미래를 함께 만들어 보세요.'
            : 'Join the waitlist and help us shape the future of SuperSheet.'}
        </p>
        <a
          href="#"
          class="btn btn-white text-lg px-8 py-4 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300"
        >
          {currentLocale === 'ja' ? 'ウェイティングリストに登録' 
            : currentLocale === 'zh' ? '加入候补名单'
            : currentLocale === 'ko' ? '대기자 명단 등록'
            : 'Join Waitlist'}
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  // Intersection Observer for scroll animations
  document.addEventListener('DOMContentLoaded', () => {
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-in');
        }
      });
    }, observerOptions);

    // Observe all milestone elements
    document.querySelectorAll('.roadmap-milestone').forEach((milestone) => {
      observer.observe(milestone);
    });

    // Add scroll progress indicator for timeline
    const updateScrollProgress = () => {
      const milestones = document.querySelectorAll('.roadmap-milestone');
      const windowHeight = window.innerHeight;
      const scrollTop = window.scrollY;

      milestones.forEach((milestone, index) => {
        const rect = milestone.getBoundingClientRect();
        const elementTop = rect.top + scrollTop;
        const elementMiddle = elementTop + rect.height / 2;
        
        // Calculate if this milestone should be "activated"
        if (scrollTop + windowHeight / 2 >= elementMiddle) {
          milestone.classList.add('milestone-passed');
        } else {
          milestone.classList.remove('milestone-passed');
        }
      });
    };

    // Throttled scroll listener
    let ticking = false;
    const handleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          updateScrollProgress();
          ticking = false;
        });
        ticking = true;
      }
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    
    // Initial check
    updateScrollProgress();
  });
</script>

<style>
  /* Scroll-triggered animations */
  .animate-on-scroll {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .animate-on-scroll.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  /* Roadmap milestone animations */
  .roadmap-milestone {
    opacity: 0;
    transform: translateY(50px) scale(0.95);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .roadmap-milestone.animate-in {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  .roadmap-milestone.milestone-passed .timeline-node {
    transform: scale(1.2);
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
  }

  /* Feature item hover effects */
  .feature-item {
    transition: all 0.3s ease;
  }

  .feature-item:hover .feature-icon {
    transform: scale(1.3);
    box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
  }

  /* Milestone card hover effects */
  .milestone-card {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .milestone-card:hover {
    transform: translateY(-8px) scale(1.02);
  }

  /* Pulse animation for status indicators */
  @keyframes soft-pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.1); }
  }

  .status-indicator.animate-pulse {
    animation: soft-pulse 2s infinite;
  }

  /* Gradient text animation */
  .bg-clip-text {
    background-size: 200% 200%;
    animation: gradient-shift 3s ease infinite;
  }

  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* Timeline effects */
  .timeline-node {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .animate-on-scroll,
    .roadmap-milestone,
    .milestone-card,
    .timeline-node,
    .feature-item {
      transition: none;
      animation: none;
    }

    .animate-on-scroll {
      opacity: 1;
      transform: none;
    }

    .roadmap-milestone {
      opacity: 1;
      transform: none;
    }

    .bg-clip-text {
      animation: none;
    }
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .milestone-card {
      border: 2px solid #000;
    }
    
    .timeline-node {
      border-color: #000;
    }
    
    .feature-icon {
      background-color: #000;
    }
  }
</style>